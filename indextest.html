<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TEST - Chúc Mừng Năm Mới</title>

    <!-- CSS TỪ FILE style.css -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Quicksand:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0015;
            --bg-mid: #1a0030;
            --bg-light: #2d1b4e;
            --pink: #ff6b9d;
            --pink-light: #ff9ec5;
            --gold: #ffd700;
            --gold-light: #ffe44d;
            --red: #ff4466;
            --white: #fff;
            --text-soft: rgba(255, 255, 255, 0.85);
        }

        html {
            overflow: hidden;
            height: 100%;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), var(--bg-mid), var(--bg-light));
            background-size: 400% 400%;
            animation: bgShift 20s ease infinite;
            color: var(--white);
            overflow: hidden;
            height: 100%;
            width: 100%;
        }

        @keyframes bgShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        /* ========== FIREWORKS CANVAS ========== */
        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* ========== PARTICLE TEXT CANVAS ========== */
        #particle-text-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 55;
            background: radial-gradient(ellipse at center, rgba(26, 0, 48, 0.95) 0%, rgba(10, 0, 21, 0.98) 70%);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
            pointer-events: none;
        }

        #particle-text-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        #particle-text-canvas {
            width: 100%;
            height: 100%;
        }

        /* ========== VIDEO OVERLAY ========== */
        #video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        #video-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        #celebration-video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* ========== FALLING PETALS ========== */
        .petal {
            position: fixed;
            z-index: 2;
            pointer-events: none;
            animation: petalFall linear forwards;
            will-change: transform;
        }

        @keyframes petalFall {
            0% {
                transform: translateY(-10vh) rotate(0deg) translateX(0);
                opacity: 0.9;
            }

            25% {
                transform: translateY(22vh) rotate(90deg) translateX(30px);
            }

            50% {
                transform: translateY(48vh) rotate(180deg) translateX(-20px);
            }

            75% {
                transform: translateY(72vh) rotate(270deg) translateX(25px);
            }

            100% {
                transform: translateY(105vh) rotate(360deg) translateX(-10px);
                opacity: 0;
            }
        }

        /* ========== CURSOR TRAIL ========== */
        .cursor-heart {
            position: fixed;
            z-index: 60;
            pointer-events: none;
            animation: cursorHeartFade 1s ease-out forwards;
            will-change: transform, opacity;
        }

        @keyframes cursorHeartFade {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) translateY(0);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3) translateY(-40px);
            }
        }

        /* ========== ĐÈN LỒNG ========== */
        .lantern {
            position: fixed;
            z-index: 3;
            pointer-events: none;
            bottom: -80px;
            animation: lanternFloat linear forwards;
            will-change: transform;
        }

        .lantern-body {
            width: 36px;
            height: 50px;
            background: radial-gradient(ellipse at 40% 35%, #ff5533 20%, #dd2200 60%, #aa0000 100%);
            border-radius: 50% 50% 45% 45%;
            position: relative;
            box-shadow: 0 0 20px rgba(255, 80, 0, 0.4);
            animation: lanternSway 3s ease-in-out infinite;
        }

        .lantern-body::before {
            content: '';
            position: absolute;
            top: -7px;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 7px;
            background: var(--gold);
            border-radius: 3px 3px 0 0;
        }

        .lantern-body::after {
            content: '';
            position: absolute;
            bottom: -14px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 14px;
            background: var(--gold);
            box-shadow: -4px 6px 0 var(--gold), 4px 6px 0 var(--gold);
        }

        .lantern-glow {
            position: absolute;
            top: 20%;
            left: 20%;
            width: 60%;
            height: 50%;
            background: radial-gradient(circle, rgba(255, 200, 50, 0.5) 0%, transparent 70%);
            border-radius: 50%;
        }

        @keyframes lanternFloat {
            0% {
                transform: translateY(0);
                opacity: 0;
            }

            5% {
                opacity: 0.9;
            }

            90% {
                opacity: 0.9;
            }

            100% {
                transform: translateY(calc(-100vh - 120px));
                opacity: 0;
            }
        }

        @keyframes lanternSway {

            0%,
            100% {
                transform: rotate(-3deg);
            }

            50% {
                transform: rotate(3deg);
            }
        }

        /* ========== MUSIC BUTTON ========== */
        .music-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--pink);
            background: rgba(255, 107, 157, 0.15);
            backdrop-filter: blur(8px);
            color: var(--pink);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(255, 107, 157, 0.3);
        }

        .music-btn:hover {
            background: rgba(255, 107, 157, 0.3);
            transform: scale(1.1);
        }

        .music-btn.playing {
            animation: musicPulse 1.5s ease-in-out infinite;
        }

        @keyframes musicPulse {

            0%,
            100% {
                box-shadow: 0 0 15px rgba(255, 107, 157, 0.3);
            }

            50% {
                box-shadow: 0 0 30px rgba(255, 107, 157, 0.6);
            }
        }

        /* ========== MẬT MÃ SINH NHẬT ========== */
        .passcode-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 52;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(ellipse at 30% 40%, rgba(120, 20, 100, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 60%, rgba(60, 20, 140, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at center, #12001f 0%, #080010 70%);
            transition: opacity 1.5s ease, visibility 1.5s ease;
        }

        .passcode-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .passcode-hearts {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .passcode-content {
            text-align: center;
            z-index: 2;
            animation: fadeInUp 1.5s ease-out;
            padding: 0 20px;
        }

        .passcode-icon {
            font-size: 70px;
            margin-bottom: 20px;
            animation: envelopeBounce 2s ease-in-out infinite;
        }

        .passcode-title {
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            color: var(--gold);
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            margin-bottom: 15px;
        }

        .passcode-question {
            font-size: 1.15rem;
            color: var(--text-soft);
            margin-bottom: 8px;
            font-weight: 400;
        }

        .passcode-hint {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 30px;
        }

        .passcode-input-wrapper {
            margin-bottom: 25px;
            position: relative;
        }

        .passcode-input {
            width: 260px;
            padding: 15px 24px;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--gold);
            background: rgba(20, 5, 35, 0.7);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 16px;
            text-align: center;
            letter-spacing: 3px;
            outline: none;
            transition: all 0.4s ease;
        }

        .passcode-input:focus {
            border-color: var(--pink);
            box-shadow: 0 0 25px rgba(255, 107, 157, 0.3);
        }

        .passcode-input.shake {
            animation: inputShake 0.5s ease;
            border-color: var(--red);
        }

        @keyframes inputShake {

            0%,
            100% {
                transform: translateX(0);
            }

            20% {
                transform: translateX(-12px);
            }

            40% {
                transform: translateX(12px);
            }

            60% {
                transform: translateX(-8px);
            }

            80% {
                transform: translateX(8px);
            }
        }

        .passcode-error {
            color: var(--red);
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .passcode-error.show {
            opacity: 1;
        }

        .passcode-btn {
            padding: 14px 45px;
            font-family: 'Quicksand', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--white);
            background: linear-gradient(135deg, var(--pink), #e0446e);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            box-shadow: 0 8px 32px rgba(255, 107, 157, 0.4);
            letter-spacing: 1px;
        }

        .passcode-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 45px rgba(255, 107, 157, 0.6);
        }

        /* ========== WELCOME SCREEN ========== */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(ellipse at 30% 50%, rgba(100, 20, 80, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 50%, rgba(60, 20, 120, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at center, #1a0030 0%, #0a0015 70%);
            transition: opacity 1.5s ease, visibility 1.5s ease;
        }

        .welcome-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .welcome-hearts {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .welcome-heart {
            position: absolute;
            opacity: 0.2;
            animation: floatHeart 6s ease-in-out infinite;
            will-change: transform;
        }

        @keyframes floatHeart {

            0%,
            100% {
                transform: translateY(0) scale(1);
                opacity: 0.15;
            }

            50% {
                transform: translateY(-40px) scale(1.2);
                opacity: 0.35;
            }
        }

        .welcome-content {
            text-align: center;
            z-index: 2;
            animation: fadeInUp 1.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-title {
            font-family: 'Great Vibes', cursive;
            font-size: 3.5rem;
            color: var(--gold);
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5), 0 0 60px rgba(255, 215, 0, 0.2);
            margin-bottom: 15px;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: var(--text-soft);
            margin-bottom: 35px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        /* ========== PHONG BÌ 3D ========== */
        .envelope-3d {
            width: 260px;
            height: 180px;
            position: relative;
            cursor: pointer;
            margin: 0 auto 20px;
            perspective: 800px;
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
            animation: envelopeFloat 3s ease-in-out infinite;
        }

        .envelope-3d:hover {
            transform: scale(1.05) translateY(-5px);
        }

        @keyframes envelopeFloat {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .envelope-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #e83e6c 0%, #c82854 40%, #a01e44 100%);
            border-radius: 0 0 8px 8px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 12px 40px rgba(232, 62, 108, 0.4), 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 1;
        }

        .envelope-body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 130px solid rgba(255, 255, 255, 0.08);
            border-right: 130px solid rgba(255, 255, 255, 0.08);
            border-bottom: 90px solid transparent;
        }

        .envelope-body::after {
            content: '';
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 70%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            opacity: 0.5;
        }

        .envelope-flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 130px solid transparent;
            border-right: 130px solid transparent;
            border-top: 100px solid #d43060;
            z-index: 3;
            transform-origin: top center;
            transition: transform 1s cubic-bezier(0.23, 1, 0.32, 1);
            filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.2));
        }

        .envelope-3d.opened .envelope-flap {
            transform: rotateX(180deg);
            z-index: 0;
        }

        .envelope-flap::after {
            content: '';
            position: absolute;
            top: -100px;
            left: -130px;
            width: 0;
            height: 0;
            border-left: 130px solid transparent;
            border-right: 130px solid transparent;
            border-top: 100px solid #b82550;
        }

        .envelope-letter {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            height: 80%;
            background: linear-gradient(180deg, #fff 0%, #fef0f5 100%);
            border-radius: 6px 6px 4px 4px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 2;
            transition: transform 1.2s cubic-bezier(0.23, 1, 0.32, 1) 0.4s, box-shadow 0.8s ease 0.4s;
            overflow: hidden;
        }

        .envelope-3d.opened .envelope-letter {
            transform: translateX(-50%) translateY(-120%);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.4), 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .letter-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 15px;
        }

        .letter-heart {
            font-size: 28px;
            margin-bottom: 6px;
            animation: heartBeat 1.5s ease-in-out infinite;
        }

        .letter-text {
            font-family: 'Great Vibes', cursive;
            font-size: 1.2rem;
            color: var(--pink);
            text-align: center;
        }

        .envelope-shadow {
            position: absolute;
            bottom: -15px;
            left: 10%;
            width: 80%;
            height: 12px;
            background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.25) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 0;
            transition: all 0.3s ease;
        }

        .envelope-3d:hover .envelope-shadow {
            width: 90%;
            left: 5%;
            opacity: 0.7;
        }

        .envelope-cta {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 10px;
            animation: ctaPulse 2.5s ease-in-out infinite;
        }

        @keyframes ctaPulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 0.8;
            }
        }

        /* ========== MAIN CONTENT & PAGES ========== */
        .main-content {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            overflow: hidden;
        }

        .main-content.visible {
            display: block;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* ========== PAGE SYSTEM ========== */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transform: translateX(0);
            pointer-events: none;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .page.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
            pointer-events: auto;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
        }

        .page.slide-out-left {
            opacity: 0;
            visibility: visible;
            transform: translateX(-100%);
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
        }

        .page.slide-out-right {
            opacity: 0;
            visibility: visible;
            transform: translateX(100%);
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
        }

        .page.enter-from-right {
            transform: translateX(100%);
            visibility: visible;
        }

        .page.enter-from-left {
            transform: translateX(-100%);
            visibility: visible;
        }

        .page-inner {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 60px 20px;
            margin: 0 auto;
        }

        .gallery-page-inner {
            justify-content: flex-start;
            min-height: auto;
            padding-top: 60px;
            padding-bottom: 120px;
        }

        /* ========== PAGE NAVIGATION ========== */
        .page-nav {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 30;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(20, 5, 35, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 157, 0.2);
            border-radius: 50px;
            padding: 8px 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }

        .page-nav-btn {
            background: none;
            border: none;
            color: var(--pink-light);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0 5px;
            line-height: 1;
        }

        .page-nav-btn:hover {
            color: var(--pink);
            transform: scale(1.3);
        }

        .page-dots {
            display: flex;
            gap: 8px;
        }

        .page-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 107, 157, 0.25);
            cursor: pointer;
            transition: all 0.4s ease;
        }

        .page-dot.active {
            background: var(--pink);
            box-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
            transform: scale(1.3);
        }

        .page-hint {
            position: absolute;
            bottom: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.8s ease;
            animation: hintPulse 2.5s ease-in-out infinite;
        }

        .page-hint span {
            font-size: 0.8rem;
            letter-spacing: 1px;
            color: var(--pink-light);
        }

        .page-hint-arrow {
            font-size: 1.4rem;
            color: var(--pink-light);
        }

        @keyframes hintPulse {

            0%,
            100% {
                opacity: 0.4;
                transform: translateX(0);
            }

            50% {
                opacity: 0.8;
                transform: translateX(8px);
            }
        }

        /* ========== COUNTDOWN ========== */
        .countdown-label {
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            color: var(--gold);
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
            margin-bottom: 10px;
        }

        .countdown-year {
            font-size: 1.2rem;
            color: var(--pink-light);
            margin-bottom: 50px;
            font-weight: 300;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .countdown-timer {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 40px;
        }

        .countdown-box {
            background: rgba(20, 5, 35, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 107, 157, 0.25);
            border-radius: 20px;
            padding: 25px 20px;
            min-width: 120px;
            text-align: center;
            transition: all 0.4s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .countdown-box:hover {
            transform: translateY(-8px) scale(1.05);
            border-color: var(--pink);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.25);
        }

        .countdown-number {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            line-height: 1;
            margin-bottom: 8px;
        }

        .countdown-unit {
            font-size: 0.85rem;
            color: var(--pink-light);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 500;
        }

        .countdown-complete {
            display: none;
            text-align: center;
            animation: scaleIn 1s ease-out;
        }

        .countdown-complete.show {
            display: block;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.5);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .countdown-complete h2 {
            font-family: 'Great Vibes', cursive;
            font-size: 4rem;
            color: var(--gold);
            text-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
        }

        /* ========== MESSAGE ========== */
        .message-card {
            max-width: 700px;
            width: 100%;
            background: rgba(20, 5, 35, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 107, 157, 0.2);
            border-radius: 30px;
            padding: 50px 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
        }

        .message-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--pink), var(--gold), var(--pink), var(--gold));
            border-radius: 31px;
            z-index: -1;
            opacity: 0.3;
            background-size: 400%;
            animation: borderGlow 8s linear infinite;
        }

        @keyframes borderGlow {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .message-to {
            font-family: 'Great Vibes', cursive;
            font-size: 2.2rem;
            color: var(--pink);
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.4);
            margin-bottom: 5px;
        }

        .message-name {
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            color: var(--gold);
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            margin-bottom: 30px;
        }

        .message-divider {
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--pink), transparent);
            margin: 0 auto 30px;
        }

        .message-text {
            font-size: 1.15rem;
            line-height: 2;
            color: var(--text-soft);
            min-height: 180px;
            font-weight: 400;
        }

        .message-text .cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: var(--pink);
            margin-left: 2px;
            animation: blink 0.8s ease-in-out infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        .message-signature {
            text-align: right;
            margin-top: 30px;
            font-family: 'Great Vibes', cursive;
            font-size: 1.8rem;
            color: var(--pink);
            opacity: 0;
            transition: opacity 1s ease;
        }

        .message-signature.show {
            opacity: 1;
        }

        /* ========== POLAROID GALLERY ========== */
        .gallery-title {
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            color: var(--gold);
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
            margin-bottom: 10px;
            text-align: center;
        }

        .gallery-subtitle {
            color: var(--text-soft);
            font-size: 1.1rem;
            margin-bottom: 30px;
            font-weight: 300;
            letter-spacing: 1px;
            text-align: center;
        }

        .polaroid-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            max-width: 850px;
            margin: 0 auto;
            padding: 0 15px;
            perspective: 1000px;
        }

        .polaroid {
            background: #fafafa;
            padding: 10px 10px 40px 10px;
            border-radius: 4px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35), 0 2px 6px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            transform: rotate(var(--rotate, 0deg));
            transform-style: preserve-3d;
            position: relative;
            animation: polaroidIn 0.8s ease backwards;
            will-change: transform;
        }

        .polaroid:nth-child(1) {
            animation-delay: 0.05s;
        }

        .polaroid:nth-child(2) {
            animation-delay: 0.1s;
        }

        .polaroid:nth-child(3) {
            animation-delay: 0.15s;
        }

        .polaroid:nth-child(4) {
            animation-delay: 0.2s;
        }

        .polaroid:nth-child(5) {
            animation-delay: 0.25s;
        }

        .polaroid:nth-child(6) {
            animation-delay: 0.3s;
        }

        .polaroid:nth-child(7) {
            animation-delay: 0.35s;
        }

        .polaroid:nth-child(8) {
            animation-delay: 0.4s;
        }

        .polaroid:nth-child(9) {
            animation-delay: 0.45s;
        }

        .polaroid:nth-child(10) {
            animation-delay: 0.5s;
        }

        .polaroid:nth-child(11) {
            animation-delay: 0.55s;
        }

        .polaroid:nth-child(12) {
            animation-delay: 0.6s;
        }

        .polaroid:nth-child(13) {
            animation-delay: 0.65s;
        }

        @keyframes polaroidIn {
            from {
                opacity: 0;
                transform: rotate(var(--rotate, 0deg)) translateY(40px) scale(0.8);
            }

            to {
                opacity: 1;
                transform: rotate(var(--rotate, 0deg)) translateY(0) scale(1);
            }
        }

        .polaroid:hover {
            transform: rotate(0deg) scale(1.08) translateY(-8px);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.3), 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 5;
        }

        .polaroid-photo {
            overflow: hidden;
            border-radius: 2px;
            background: #ddd;
        }

        .polaroid-photo img {
            width: 100%;
            display: block;
            transition: transform 0.5s ease;
        }

        .polaroid:hover .polaroid-photo img {
            transform: scale(1.05);
        }

        .polaroid-caption {
            font-family: 'Great Vibes', cursive;
            font-size: 1rem;
            color: #555;
            text-align: center;
            margin-top: 8px;
            padding: 0 5px;
        }

        /* ========== GIFT BOX ========== */
        .gift-title {
            font-family: 'Great Vibes', cursive;
            font-size: 2.5rem;
            color: var(--gold);
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
            margin-bottom: 15px;
        }

        .gift-subtitle {
            color: var(--text-soft);
            font-size: 1rem;
            margin-bottom: 50px;
            font-weight: 300;
        }

        .gift-box-wrapper {
            perspective: 800px;
            cursor: pointer;
            margin-bottom: 40px;
            filter: drop-shadow(0 0 20px rgba(232, 62, 108, 0.3));
            animation: giftPulse 3s ease-in-out infinite;
        }

        @keyframes giftPulse {

            0%,
            100% {
                filter: drop-shadow(0 0 20px rgba(232, 62, 108, 0.3));
            }

            50% {
                filter: drop-shadow(0 0 35px rgba(232, 62, 108, 0.5));
            }
        }

        .gift-box {
            width: 180px;
            height: 180px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.4s ease;
        }

        .gift-box:hover {
            transform: translateY(-10px);
        }

        .gift-box-body {
            width: 180px;
            height: 150px;
            background: linear-gradient(135deg, #e83e6c, #c82854);
            border-radius: 10px;
            position: absolute;
            bottom: 0;
            box-shadow: 0 15px 40px rgba(232, 62, 108, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gift-box-body::before {
            content: '';
            position: absolute;
            width: 25px;
            height: 100%;
            background: var(--gold);
            left: 50%;
            transform: translateX(-50%);
            border-radius: 3px;
        }

        .gift-box-body::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 25px;
            background: var(--gold);
            top: 50%;
            transform: translateY(-50%);
            border-radius: 3px;
        }

        .gift-box-lid {
            width: 200px;
            height: 40px;
            background: linear-gradient(135deg, #f04e7e, #d43868);
            border-radius: 10px;
            position: absolute;
            top: 0;
            left: -10px;
            transform-origin: left bottom;
            transition: transform 0.8s cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 0 -5px 20px rgba(232, 62, 108, 0.3);
            z-index: 2;
        }

        .gift-box-lid::before {
            content: '';
            position: absolute;
            width: 50px;
            height: 50px;
            border: 8px solid var(--gold);
            border-radius: 50% 50% 0 0;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            border-bottom: none;
        }

        .gift-box.opened .gift-box-lid {
            transform: rotate(-110deg);
        }

        .gift-message {
            opacity: 0;
            transform: translateY(30px);
            transition: all 1s ease 0.5s;
            text-align: center;
        }

        .gift-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .gift-message-text {
            font-family: 'Great Vibes', cursive;
            font-size: 3.5rem;
            background: linear-gradient(135deg, var(--pink), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 20px rgba(255, 107, 157, 0.5));
            animation: heartBeat 1.5s ease-in-out infinite;
        }

        @keyframes heartBeat {

            0%,
            100% {
                transform: scale(1);
            }

            15% {
                transform: scale(1.1);
            }

            30% {
                transform: scale(1);
            }

            45% {
                transform: scale(1.08);
            }

            60% {
                transform: scale(1);
            }
        }

        .gift-hearts {
            margin-top: 20px;
            font-size: 2rem;
            animation: floatHeart 3s ease-in-out infinite;
        }

        /* ========== CONFETTI ========== */
        .confetti-piece {
            position: fixed;
            z-index: 60;
            pointer-events: none;
            animation: confettiFall linear forwards;
            will-change: transform;
        }

        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }

            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }

        /* ========== LIGHTBOX ========== */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 200;
            background: rgba(0, 0, 0, 0.92);
            backdrop-filter: blur(12px);
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .lightbox.active {
            display: flex;
            opacity: 1;
        }

        .lightbox-content {
            max-width: 90vw;
            max-height: 85vh;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lightbox-content img {
            max-width: 90vw;
            max-height: 80vh;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 40px rgba(255, 107, 157, 0.2);
            object-fit: contain;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 25px;
            background: none;
            border: none;
            color: #fff;
            font-size: 40px;
            cursor: pointer;
            z-index: 201;
            transition: all 0.3s ease;
            line-height: 1;
        }

        .lightbox-close:hover {
            color: var(--pink);
            transform: rotate(90deg) scale(1.2);
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 107, 157, 0.15);
            border: 1px solid rgba(255, 107, 157, 0.3);
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            z-index: 201;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .lightbox-nav:hover {
            background: rgba(255, 107, 157, 0.4);
            transform: translateY(-50%) scale(1.1);
        }

        .lightbox-prev {
            left: 20px;
        }

        .lightbox-next {
            right: 20px;
        }

        .lightbox-counter {
            margin-top: 15px;
            color: var(--text-soft);
            font-size: 0.9rem;
            letter-spacing: 2px;
        }

        /* ========== STARFIELD ========== */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle ease-in-out infinite;
            will-change: opacity;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.2;
            }

            50% {
                opacity: 0.8;
            }
        }

        /* ========== PARTICLE BACKGROUND ========== */
        .bg-particle {
            position: fixed;
            z-index: 0;
            pointer-events: none;
            opacity: 0.15;
            animation: particleFloat linear infinite;
            will-change: transform;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.2;
            }

            90% {
                opacity: 0.2;
            }

            100% {
                transform: translateY(-10vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* MOBILE OPTIMIZATIONS */
        html.mobile body {
            animation: none !important;
            background-size: 100% 100% !important;
        }

        html.mobile .countdown-box,
        html.mobile .message-card,
        html.mobile .music-btn,
        html.mobile .page-nav {
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }

        html.mobile .countdown-box {
            background: rgba(20, 5, 35, 0.85);
        }

        html.mobile .message-card {
            background: rgba(20, 5, 35, 0.88);
        }

        html.mobile .music-btn {
            background: rgba(20, 5, 35, 0.8);
        }

        html.mobile .page-nav {
            background: rgba(20, 5, 35, 0.75);
        }

        html.mobile .message-card::before {
            animation: none;
            opacity: 0.2;
        }

        html.mobile .gift-box-wrapper {
            animation: none;
            filter: none;
        }

        html.mobile .envelope-3d {
            width: 220px;
            height: 150px;
        }

        html.mobile .envelope-flap {
            border-left-width: 110px;
            border-right-width: 110px;
            border-top-width: 85px;
        }

        html.mobile .envelope-flap::after {
            left: -110px;
            top: -85px;
            border-left-width: 110px;
            border-right-width: 110px;
            border-top-width: 85px;
        }

        html.mobile .envelope-body::before {
            border-left-width: 110px;
            border-right-width: 110px;
            border-bottom-width: 75px;
        }

        /* ANIMATED GRADIENT TEXT */
        .gradient-text-animated {
            background: linear-gradient(90deg, var(--gold) 0%, var(--pink) 25%, var(--gold-light) 50%, var(--pink-light) 75%, var(--gold) 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShimmer 4s linear infinite;
            position: relative;
        }

        .gradient-text-animated::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
            animation: textShine 5s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes gradientShimmer {
            0% {
                background-position: 0% center;
            }

            100% {
                background-position: 200% center;
            }
        }

        @keyframes textShine {

            0%,
            100% {
                left: -100%;
            }

            50% {
                left: 150%;
            }
        }

        /* HEART TRANSITION */
        .heart-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 53;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
        }

        .heart-transition.active {
            opacity: 1;
            visibility: visible;
            pointer-events: all;
        }

        .heart-transition-icon {
            font-size: 40px;
            transform: scale(0);
            transition: none;
        }

        .heart-transition.active .heart-transition-icon {
            animation: heartExpand 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes heartExpand {
            0% {
                transform: scale(0);
                opacity: 1;
                filter: drop-shadow(0 0 20px rgba(255, 107, 157, 0.8));
            }

            40% {
                transform: scale(8);
                opacity: 1;
                filter: drop-shadow(0 0 60px rgba(255, 107, 157, 0.6));
            }

            70% {
                transform: scale(30);
                opacity: 0.8;
                filter: drop-shadow(0 0 100px rgba(255, 107, 157, 0.4));
            }

            100% {
                transform: scale(80);
                opacity: 0;
                filter: drop-shadow(0 0 0px transparent);
            }
        }

        /* POLAROID 3D SHINE */
        .polaroid::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.08) 40%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.08) 60%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            border-radius: 4px;
        }

        .polaroid:hover::after {
            opacity: 1;
        }

        .message-chinese-quote {
            font-style: italic;
            color: var(--pink-light);
            font-size: 0.95rem;
            opacity: 0.9;
            display: block;
            margin-top: 5px;
            letter-spacing: 1px;
        }

        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2.5rem;
            }

            .envelope-3d {
                width: 200px;
                height: 140px;
            }

            .countdown-label {
                font-size: 2.2rem;
            }

            .countdown-box {
                min-width: 90px;
                padding: 18px 14px;
            }

            .countdown-number {
                font-size: 2.5rem;
            }

            .message-card {
                padding: 35px 25px;
            }

            .message-name {
                font-size: 2.2rem;
            }

            .message-text {
                font-size: 1rem;
            }

            .gift-message-text {
                font-size: 2.5rem;
            }

            .gift-box {
                width: 140px;
                height: 140px;
            }

            .gift-box-body {
                width: 140px;
                height: 115px;
            }

            .gift-box-lid {
                width: 160px;
                height: 35px;
                left: -10px;
            }

            .countdown-complete h2 {
                font-size: 3rem;
            }

            .music-btn {
                width: 42px;
                height: 42px;
                font-size: 16px;
                bottom: 15px;
                right: 15px;
            }

            .lantern-body {
                width: 28px;
                height: 40px;
            }

            .polaroid-gallery {
                grid-template-columns: repeat(2, 1fr);
                gap: 14px;
            }

            .polaroid {
                padding: 7px 7px 30px 7px;
            }

            .polaroid-caption {
                font-size: 0.85rem;
            }

            .gallery-title {
                font-size: 2.2rem;
            }

            .lightbox-nav {
                width: 40px;
                height: 40px;
                font-size: 22px;
            }

            .lightbox-prev {
                left: 8px;
            }

            .lightbox-next {
                right: 8px;
            }

            .lightbox-close {
                top: 12px;
                right: 15px;
                font-size: 32px;
            }

            .passcode-title {
                font-size: 2.2rem;
            }

            .passcode-icon {
                font-size: 50px;
            }

            .passcode-input {
                width: 220px;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 2rem;
            }

            .countdown-timer {
                gap: 12px;
            }

            .countdown-box {
                min-width: 70px;
                padding: 14px 10px;
            }

            .countdown-number {
                font-size: 2rem;
            }

            .message-card {
                padding: 25px 18px;
                border-radius: 20px;
            }

            .message-to {
                font-size: 1.6rem;
            }

            .message-name {
                font-size: 1.8rem;
            }

            .polaroid-gallery {
                gap: 10px;
            }

            .polaroid {
                padding: 5px 5px 25px 5px;
            }

            .polaroid-caption {
                font-size: 0.75rem;
                margin-top: 5px;
            }
        }
    </style>
</head>

<body>

    <!-- Canvas pháo hoa -->
    <canvas id="fireworks-canvas"></canvas>

    <!-- Nền sao lấp lánh -->
    <div class="starfield" id="starfield"></div>

    <!-- Particle Text Overlay -->
    <div id="particle-text-overlay">
        <canvas id="particle-text-canvas"></canvas>
    </div>

    <!-- Video Giao Thừa Overlay -->
    <div id="video-overlay">
        <video id="celebration-video" playsinline>
            <source src="videonen.mp4" type="video/mp4">
        </video>
    </div>

    <!-- Nhạc nền MP3 -->
    <audio id="bg-music" loop preload="auto">
        <source src="nhacnen.mp3" type="audio/mpeg">
    </audio>

    <!-- Nút nhạc -->
    <button class="music-btn" onclick="toggleMusic()" title="Bật/Tắt nhạc">🔇</button>

    <!-- ========== MẬT MÃ SINH NHẬT ========== -->
    <div class="passcode-screen" id="passcode-screen">
        <div class="passcode-hearts"></div>
        <div class="passcode-content">
            <div class="passcode-icon">🔐</div>
            <h2 class="passcode-title">Mật Mã Tình Yêu</h2>
            <p class="passcode-question">Ngày sinh nhật của bảo bối là ngày nào?</p>
            <p class="passcode-hint">Nhập theo định dạng DD/MM/YYYY</p>
            <div class="passcode-input-wrapper">
                <input type="text" id="passcode-input" class="passcode-input" placeholder="DD/MM/YYYY" maxlength="10"
                    autocomplete="off" inputmode="numeric">
                <div class="passcode-error" id="passcode-error">Sai rồi, thử lại nhé! 💔</div>
            </div>
            <button class="passcode-btn" onclick="checkPasscode()">💕 Xác Nhận 💕</button>
        </div>
    </div>

    <!-- Heart Transition Overlay -->
    <div class="heart-transition" id="heart-transition">
        <div class="heart-transition-icon">💕</div>
    </div>

    <!-- ========== WELCOME SCREEN ========== -->
    <div class="welcome-screen hidden" id="welcome">
        <div class="welcome-hearts"></div>
        <div class="welcome-content">
            <h1 class="welcome-title gradient-text-animated">Gửi Em Yêu...</h1>
            <p class="welcome-subtitle">Anh có một điều muốn nói với Em</p>

            <!-- Phong bì 3D -->
            <div class="envelope-3d" id="envelope-3d" onclick="openEnvelope()">
                <div class="envelope-flap"></div>
                <div class="envelope-body">
                    <div class="envelope-letter" id="envelope-letter">
                        <div class="letter-content">
                            <span class="letter-heart">💕</span>
                            <span class="letter-text">Mở Thư Tình</span>
                        </div>
                    </div>
                </div>
                <div class="envelope-shadow"></div>
            </div>
            <p class="envelope-cta">Nhấn vào phong bì để mở 💌</p>
        </div>
    </div>

    <!-- ========== MAIN CONTENT (Pages) ========== -->
    <div class="main-content" id="main-content">

        <!-- Page Navigation -->
        <div class="page-nav" id="page-nav">
            <button class="page-nav-btn page-prev" onclick="changePage(-1)">‹</button>
            <div class="page-dots" id="page-dots"></div>
            <button class="page-nav-btn page-next" onclick="changePage(1)">›</button>
        </div>

        <!-- PAGE 1: Countdown -->
        <div class="page active" id="page-0">
            <div class="page-inner">
                <h2 class="countdown-label gradient-text-animated">Đếm Ngược Giao Thừa</h2>
                <p class="countdown-year">✨ Tết Nguyên Đán 2026 (TEST MODE) ✨</p>

                <div class="countdown-timer">
                    <div class="countdown-box">
                        <div class="countdown-number" id="days">00</div>
                        <div class="countdown-unit">Ngày</div>
                    </div>
                    <div class="countdown-box">
                        <div class="countdown-number" id="hours">00</div>
                        <div class="countdown-unit">Giờ</div>
                    </div>
                    <div class="countdown-box">
                        <div class="countdown-number" id="minutes">00</div>
                        <div class="countdown-unit">Phút</div>
                    </div>
                    <div class="countdown-box">
                        <div class="countdown-number" id="seconds">00</div>
                        <div class="countdown-unit">Giây</div>
                    </div>
                </div>

                <div class="countdown-complete">
                    <h2 class="gradient-text-animated">🎉 Chúc Mừng Năm Mới! 🎉</h2>
                </div>

                <div class="page-hint">
                    <span>Vuốt hoặc nhấn → để sang trang</span>
                    <div class="page-hint-arrow">→</div>
                </div>
            </div>
        </div>

        <!-- PAGE 2: Lời Chúc -->
        <div class="page" id="page-1">
            <div class="page-inner">
                <div class="message-card">
                    <div class="message-to">Gửi đến</div>
                    <div class="message-name">Hoàng Thị Anh Thơ</div>
                    <div class="message-divider"></div>
                    <div class="message-text"></div>
                    <div class="message-signature">
                        ~ Hubby của em 💕
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE 3: Gallery Ảnh Polaroid -->
        <div class="page" id="page-2">
            <div class="page-inner gallery-page-inner">
                <h2 class="gallery-title gradient-text-animated">🖼️ Kỷ Niệm Của Chúng Ta</h2>
                <p class="gallery-subtitle">Những khoảnh khắc đáng nhớ bên nhau ✨</p>

                <div class="polaroid-gallery" id="polaroid-gallery">
                    <div class="polaroid" onclick="openLightbox(0)" style="--rotate: -3deg">
                        <div class="polaroid-photo"><img src="anh/z7538148079369_3b58fabb2458d542f45aefeebda582c7.jpg"
                                alt="Kỷ niệm 1" loading="lazy"></div>
                        <div class="polaroid-caption">💕 Kỷ niệm</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(1)" style="--rotate: 2deg">
                        <div class="polaroid-photo"><img src="anh/z7538148093159_dacd11dcaad58e8e406992b324ca4f2f.jpg"
                                alt="Kỷ niệm 2" loading="lazy"></div>
                        <div class="polaroid-caption">💖 Yêu thương</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(2)" style="--rotate: -1deg">
                        <div class="polaroid-photo"><img src="anh/z7538148094666_23071c33da61f65b1d9e2db02f653a92.jpg"
                                alt="Kỷ niệm 3" loading="lazy"></div>
                        <div class="polaroid-caption">✨ Hạnh phúc</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(3)" style="--rotate: 4deg">
                        <div class="polaroid-photo"><img src="anh/z7538148096271_3e4d0bae9afa7e4f63c6d4238af9b7f6.jpg"
                                alt="Kỷ niệm 4" loading="lazy"></div>
                        <div class="polaroid-caption">🌸 Bên nhau</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(4)" style="--rotate: -2deg">
                        <div class="polaroid-photo"><img src="anh/z7538148098402_2769a9f1161dc0a42d9e278b22d51cbc.jpg"
                                alt="Kỷ niệm 5" loading="lazy"></div>
                        <div class="polaroid-caption"> Ngọt ngào</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(5)" style="--rotate: 3deg">
                        <div class="polaroid-photo"><img src="anh/z7538148099395_4ae7117b33d731b95866a1bf7b777b2c.jpg"
                                alt="Kỷ niệm 6" loading="lazy"></div>
                        <div class="polaroid-caption">💝 Mãi mãi</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(6)" style="--rotate: -4deg">
                        <div class="polaroid-photo"><img src="anh/z7538148099754_e8a7d114bfc8bbdf388bf294299ca603.jpg"
                                alt="Kỷ niệm 7" loading="lazy"></div>
                        <div class="polaroid-caption">💕 Thương</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(7)" style="--rotate: 1deg">
                        <div class="polaroid-photo"><img src="anh/z7538148103158_ba5320d36f22d72e295cfb8bd9cab7b6.jpg"
                                alt="Kỷ niệm 8" loading="lazy"></div>
                        <div class="polaroid-caption">💖 Nhớ mãi</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(8)" style="--rotate: -3deg">
                        <div class="polaroid-photo"><img src="anh/z7538148108267_0cf240873128321c89c46a28f268666e.jpg"
                                alt="Kỷ niệm 9" loading="lazy"></div>
                        <div class="polaroid-caption">✨ Đẹp quá</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(9)" style="--rotate: 2deg">
                        <div class="polaroid-photo"><img src="anh/z7538148110785_51ea48c139aa8111b43dcb59c1f08972.jpg"
                                alt="Kỷ niệm 10" loading="lazy"></div>
                        <div class="polaroid-caption">🌸 Cùng nhau</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(10)" style="--rotate: -1deg">
                        <div class="polaroid-photo"><img src="anh/z7538148121807_f9aaa722193a0105f902a313114fc49a.jpg"
                                alt="Kỷ niệm 11" loading="lazy"></div>
                        <div class="polaroid-caption">💕 Trọn vẹn</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(11)" style="--rotate: 3deg">
                        <div class="polaroid-photo"><img src="anh/z7538148123540_7080aabd5aede31a0b3faf656633d788.jpg"
                                alt="Kỷ niệm 12" loading="lazy"></div>
                        <div class="polaroid-caption">💝 Yêu Em</div>
                    </div>
                    <div class="polaroid" onclick="openLightbox(12)" style="--rotate: -2deg">
                        <div class="polaroid-photo"><img src="anh/z7538148126717_a306674fd19fe2921ae5ab4fe4e695c3.jpg"
                                alt="Kỷ niệm 13" loading="lazy"></div>
                        <div class="polaroid-caption">💕 Mãi yêu</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE 4: Gift Box -->
        <div class="page" id="page-3">
            <div class="page-inner">
                <h2 class="gift-title gradient-text-animated">Một Món Quà Nhỏ</h2>
                <p class="gift-subtitle">Nhấn vào hộp quà để mở nhé 🎁</p>

                <div class="gift-box-wrapper" onclick="openGift()">
                    <div class="gift-box">
                        <div class="gift-box-lid"></div>
                        <div class="gift-box-body"></div>
                    </div>
                </div>

                <div class="gift-message">
                    <div class="gift-message-text">Mãi Yêu Em 💕</div>
                    <div class="gift-hearts">💕 💖 💗 💝 💕</div>
                </div>
            </div>
        </div>

    </div>

    <!-- Lightbox Overlay -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox(event)">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <button class="lightbox-nav lightbox-prev" onclick="changeLightboxImage(-1, event)">&#10094;</button>
        <div class="lightbox-content">
            <img id="lightbox-img" src="" alt="Kỷ niệm">
            <div class="lightbox-counter" id="lightbox-counter"></div>
        </div>
        <button class="lightbox-nav lightbox-next" onclick="changeLightboxImage(1, event)">&#10095;</button>
    </div>

    <!-- JAVASCRIPT TỪ FILE script.js -->
    <script>
        // ============================================
        // CẤU HÌNH HIỆU NĂNG
        // ============================================
        const IS_MOBILE = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
        if (IS_MOBILE) document.documentElement.classList.add('mobile');

        const PERF = IS_MOBILE ? {
            fireworkInterval: 2200, maxPetals: 8, petalInterval: 2500,
            maxCursorTrail: 6, maxLanterns: 3, lanternInterval: 10000,
            particleTextCount: 600, starCount: 50, maxBgParticles: 5,
            bgParticleInterval: 6000
        } : {
            fireworkInterval: 1200, maxPetals: 20, petalInterval: 1200,
            maxCursorTrail: 15, maxLanterns: 6, lanternInterval: 6000,
            particleTextCount: 2000, starCount: 120, maxBgParticles: 12,
            bgParticleInterval: 3000
        };

        // ---- CẤU HÌNH NỘI DUNG (TEST MODE) ----
        // !!! THAY ĐỔI QUAN TRỌNG: Đặt thời gian đích là 5 giây kể từ lúc tải trang
        const NEW_YEAR_DATE = new Date(Date.now() + 5000);

        const LOVER_NAME = 'Hoàng Thị Anh Thơ';
        const MESSAGE_TEXT = 'Chúc mừng năm mới, Cô Gái nhỏ của anh..!\n\nChúc cho chúng ta năm mới luôn ngập tràn yêu thương, bình yên và những kỉ niệm đẹp mãi không quên.\n\nChúng ta có được nhau là duyên trời, hãy trân trọng tình yêu này mãi Em nhé!\n\nChúc mừng năm mới, bảo bối của đời Anh.\n\nChúc Em mạnh khỏe bình an và luôn nở nụ cười trong những năm mới nữa Em yêu nhé..!\n\n"我爱你，不是因为你是一个怎样的人，\n而是因为我喜欢与你在一起时的感觉" 💕\n\n\"Mãi Yêu Em\" 💕';
        const BIRTHDAY_PASSCODE = '13/05/2006';

        // ---- GLOBAL STATE ----
        let canvas, ctx;
        let musicPlaying = false;
        let audioElement = null;
        let currentPage = 0;
        const totalPages = 4;
        let pageNavLocked = true; // Khoá chuyển trang cho đến khi countdown về 0
        let audioCtx = null;

        // ============================================
        // SFX - ÂM THANH TƯƠNG TÁC (Web Audio API)
        // ============================================
        function getAudioCtx() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
            return audioCtx;
        }

        function playSfxTing() {
            try {
                const ctx = getAudioCtx();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(2400, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.6);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.6);
                const osc2 = ctx.createOscillator();
                const gain2 = ctx.createGain();
                osc2.connect(gain2);
                gain2.connect(ctx.destination);
                osc2.type = 'sine';
                osc2.frequency.setValueAtTime(1800, ctx.currentTime + 0.05);
                osc2.frequency.exponentialRampToValueAtTime(3600, ctx.currentTime + 0.15);
                gain2.gain.setValueAtTime(0.15, ctx.currentTime + 0.05);
                gain2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
                osc2.start(ctx.currentTime + 0.05);
                osc2.stop(ctx.currentTime + 0.5);
            } catch (e) { }
        }

        function playSfxEnvelope() {
            try {
                const ctx = getAudioCtx();
                const bufferSize = ctx.sampleRate * 0.4;
                const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / bufferSize, 2);
                }
                const source = ctx.createBufferSource();
                source.buffer = buffer;
                const filter = ctx.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.setValueAtTime(2000, ctx.currentTime);
                filter.frequency.linearRampToValueAtTime(6000, ctx.currentTime + 0.2);
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);
                source.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                source.start(ctx.currentTime);
            } catch (e) { }
        }

        function playSfxPop() {
            try {
                const ctx = getAudioCtx();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'sine';
                const baseFreq = 200 + Math.random() * 300;
                osc.frequency.setValueAtTime(baseFreq, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, ctx.currentTime + 0.15);
                gain.gain.setValueAtTime(0.12, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.15);
            } catch (e) { }
        }

        // ============================================
        // 1. MẬT MÃ SINH NHẬT
        // ============================================
        function initPasscode() {
            const input = document.getElementById('passcode-input');
            if (!input) return;

            input.addEventListener('input', function (e) {
                let val = this.value.replace(/\D/g, '');
                if (val.length > 8) val = val.slice(0, 8);
                if (val.length >= 5) {
                    val = val.slice(0, 2) + '/' + val.slice(2, 4) + '/' + val.slice(4);
                } else if (val.length >= 3) {
                    val = val.slice(0, 2) + '/' + val.slice(2);
                }
                this.value = val;
            });

            input.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') checkPasscode();
            });

            const container = document.querySelector('.passcode-hearts');
            if (container) {
                const hearts = ['💕', '💖', '💗', '✨', '🌸'];
                for (let i = 0; i < 12; i++) {
                    const h = document.createElement('span');
                    h.className = 'welcome-heart';
                    h.textContent = hearts[i % hearts.length];
                    h.style.cssText = `left:${Math.random() * 90}%;top:${Math.random() * 90}%;font-size:${20 + Math.random() * 30}px;animation-delay:${Math.random() * 3}s`;
                    container.appendChild(h);
                }
            }
        }

        function checkPasscode() {
            const input = document.getElementById('passcode-input');
            const error = document.getElementById('passcode-error');
            if (!input) return;

            if (input.value.trim() === BIRTHDAY_PASSCODE) {
                playSfxTing();
                const heartOverlay = document.getElementById('heart-transition');
                if (heartOverlay) heartOverlay.classList.add('active');

                setTimeout(() => {
                    const screen = document.getElementById('passcode-screen');
                    if (screen) screen.classList.add('hidden');
                    const welcome = document.getElementById('welcome');
                    if (welcome) welcome.classList.remove('hidden');
                }, 800);

                setTimeout(() => {
                    if (heartOverlay) heartOverlay.classList.remove('active');
                }, 1800);

                setTimeout(startParticleText, 1000);
            } else {
                input.classList.add('shake');
                if (error) error.classList.add('show');
                setTimeout(() => { input.classList.remove('shake'); }, 500);
                setTimeout(() => { if (error) error.classList.remove('show'); }, 2500);
            }
        }

        // ============================================
        // 2. WELCOME & MỞ THƯ
        // ============================================
        function initWelcome() {
            const container = document.querySelector('.welcome-hearts');
            if (!container) return;
            const hearts = ['💕', '💖', '💗', '✨', '🌸', '💝'];
            for (let i = 0; i < 15; i++) {
                const h = document.createElement('span');
                h.className = 'welcome-heart';
                h.textContent = hearts[i % hearts.length];
                h.style.cssText = `left:${Math.random() * 90}%;top:${Math.random() * 90}%;font-size:${20 + Math.random() * 30}px;animation-delay:${Math.random() * 4}s`;
                container.appendChild(h);
            }
        }

        let envelopeOpened = false;

        function openEnvelope() {
            if (envelopeOpened) return;
            envelopeOpened = true;
            playSfxEnvelope();

            const envelope = document.getElementById('envelope-3d');
            if (envelope) {
                envelope.classList.add('opened');
                envelope.style.animation = 'none';
            }

            setTimeout(() => {
                openLetter();
            }, 2000);
        }

        function openLetter() {
            const welcome = document.getElementById('welcome');
            if (welcome) welcome.classList.add('hidden');

            const main = document.getElementById('main-content');
            if (main) main.classList.add('visible');

            setTimeout(() => {
                initFireworks();
                startFireworks();
                startPetals();
                startCountdown();
                if (!IS_MOBILE) startCursorTrail();
                startLanterns();
                startBackgroundParticles();
                tryPlayMusic();
                initPageNav();
            }, 300);
        }

        // ============================================
        // 3. COUNTDOWN
        // ============================================
        let countdownDone = false;

        function startCountdown() {
            function update() {
                const now = new Date().getTime();
                const diff = NEW_YEAR_DATE.getTime() - now;

                if (diff <= 0) {
                    if (!countdownDone) {
                        countdownDone = true;
                        document.querySelector('.countdown-timer').style.display = 'none';
                        document.querySelector('.countdown-complete').classList.add('show');
                        for (let i = 0; i < 8; i++) setTimeout(launchFirework, i * 300);
                        spawnConfetti(IS_MOBILE ? 20 : 50);
                        showVideo();
                        scheduleUnlockPageNav();
                    }
                    return;
                }

                const d = Math.floor(diff / 86400000);
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);

                const de = document.getElementById('days');
                const he = document.getElementById('hours');
                const me = document.getElementById('minutes');
                const se = document.getElementById('seconds');
                if (de) de.textContent = String(d).padStart(2, '0');
                if (he) he.textContent = String(h).padStart(2, '0');
                if (me) me.textContent = String(m).padStart(2, '0');
                if (se) se.textContent = String(s).padStart(2, '0');
            }
            update();
            setInterval(update, 1000);
        }

        // ============================================
        // 4. PHÁO HOA
        // ============================================
        let rockets = [];
        let explosionParticles = [];
        let fireworksRunning = false;

        function initFireworks() {
            canvas = document.getElementById('fireworks-canvas');
            if (!canvas) return;
            ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            window.addEventListener('resize', () => {
                if (canvas) { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
            });
            canvas.style.pointerEvents = 'none';
            document.addEventListener('click', handleFireworkClick);
            document.addEventListener('touchstart', handleFireworkTouch, { passive: true });
        }

        function handleFireworkClick(e) {
            if (isOverlayActive()) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX;
            const y = e.clientY;
            explodeAt(x * (canvas.width / rect.width), y * (canvas.height / rect.height));
        }

        function handleFireworkTouch(e) {
            if (isOverlayActive()) return;
            const touch = e.touches[0];
            if (!touch) return;
            const rect = canvas.getBoundingClientRect();
            explodeAt(touch.clientX * (canvas.width / rect.width), touch.clientY * (canvas.height / rect.height));
        }

        function isOverlayActive() {
            const lightbox = document.getElementById('lightbox');
            const passcode = document.getElementById('passcode-screen');
            const welcome = document.getElementById('welcome');
            if (lightbox && lightbox.classList.contains('active')) return true;
            if (passcode && !passcode.classList.contains('hidden')) return true;
            if (welcome && !welcome.classList.contains('hidden')) return true;
            return false;
        }

        function explodeAt(x, y) {
            if (!ctx) return;
            playSfxPop();
            const type = Math.random();
            const count = IS_MOBILE ? 30 + Math.floor(Math.random() * 20) : 60 + Math.floor(Math.random() * 40);
            const palette = [
                () => `hsl(${350 + Math.random() * 20}, 100%, ${60 + Math.random() * 25}%)`,
                () => `hsl(${40 + Math.random() * 20}, 100%, ${55 + Math.random() * 25}%)`,
                () => `hsl(${280 + Math.random() * 40}, 80%, ${60 + Math.random() * 25}%)`,
                () => `hsl(${180 + Math.random() * 40}, 80%, ${55 + Math.random() * 30}%)`,
            ];
            const color = palette[Math.floor(Math.random() * palette.length)];

            if (type < 0.3) {
                for (let i = 0; i < count; i++) {
                    const angle = (Math.PI * 2 / count) * i;
                    const speed = 3 + Math.random() * 0.5;
                    explosionParticles.push(new Particle(x, y, color(), Math.cos(angle) * speed, Math.sin(angle) * speed, 1.8 + Math.random(), 60 + Math.random() * 30));
                }
            } else if (type < 0.6) {
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 1.2 + Math.random() * 2.5;
                    explosionParticles.push(new Particle(x, y, color(), Math.cos(angle) * speed, Math.sin(angle) * speed, 1 + Math.random(), 90 + Math.random() * 50));
                }
            } else {
                for (let i = 0; i < count; i++) {
                    const angle = (Math.PI * 2 / count) * i;
                    const speed = 2 + Math.random() * 3.5;
                    explosionParticles.push(new Particle(x, y, color(), Math.cos(angle) * speed, Math.sin(angle) * speed, 1.3 + Math.random() * 1.5, 55 + Math.random() * 40));
                }
            }
        }

        class Particle {
            constructor(x, y, color, vx, vy, size, life) {
                this.x = x; this.y = y; this.color = color;
                this.vx = vx; this.vy = vy;
                this.size = size; this.life = life; this.maxLife = life;
                this.gravity = 0.025; this.friction = 0.985;
            }
            update() {
                this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity;
                this.x += this.vx; this.y += this.vy; this.life--;
            }
            draw() {
                const alpha = Math.max(0, this.life / this.maxLife);
                ctx.globalAlpha = alpha; ctx.fillStyle = this.color; ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * alpha, 0, Math.PI * 2); ctx.fill();
                if (alpha > 0.4) {
                    ctx.globalAlpha = alpha * 0.3; ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * alpha * 3, 0, Math.PI * 2); ctx.fill();
                }
            }
            isDead() { return this.life <= 0; }
        }

        class Rocket {
            constructor() {
                this.x = Math.random() * canvas.width; this.y = canvas.height;
                this.tx = canvas.width * 0.15 + Math.random() * canvas.width * 0.7;
                this.ty = canvas.height * 0.1 + Math.random() * canvas.height * 0.3;
                this.speed = 4 + Math.random() * 2; this.exploded = false;
                const dx = this.tx - this.x, dy = this.ty - this.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                this.vx = (dx / dist) * this.speed; this.vy = (dy / dist) * this.speed;
                this.trail = [];
            }
            update() {
                this.trail.push({ x: this.x, y: this.y, alpha: 1 });
                if (this.trail.length > 8) this.trail.shift();
                this.trail.forEach(t => t.alpha -= 0.12);
                this.x += this.vx; this.y += this.vy;
                if (Math.abs(this.x - this.tx) < 15 && Math.abs(this.y - this.ty) < 15) {
                    this.exploded = true; explodeAt(this.x, this.y);
                }
            }
            draw() {
                for (const t of this.trail) {
                    if (t.alpha <= 0) continue;
                    ctx.globalAlpha = t.alpha * 0.6; ctx.fillStyle = '#ffd700'; ctx.beginPath();
                    ctx.arc(t.x, t.y, 2, 0, Math.PI * 2); ctx.fill();
                }
                ctx.globalAlpha = 1; ctx.fillStyle = '#fff'; ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2); ctx.fill();
            }
        }

        function launchFirework() { if (!canvas) return; rockets.push(new Rocket()); }

        function animateFireworks() {
            if (!fireworksRunning || !ctx) return;
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fillStyle = 'rgba(0,0,0,0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.globalCompositeOperation = 'lighter';

            for (const r of rockets) { r.update(); r.draw(); }
            rockets = rockets.filter(r => !r.exploded);

            for (const p of explosionParticles) { p.update(); p.draw(); }
            explosionParticles = explosionParticles.filter(p => !p.isDead());

            ctx.globalAlpha = 1;
            requestAnimationFrame(animateFireworks);
        }

        function startFireworks() {
            fireworksRunning = true; animateFireworks();
            setInterval(() => {
                launchFirework();
                if (!IS_MOBILE && Math.random() > 0.6) setTimeout(launchFirework, 150);
            }, PERF.fireworkInterval);
            for (let i = 0; i < (IS_MOBILE ? 2 : 5); i++) setTimeout(launchFirework, i * 300);
        }

        // ============================================
        // 5. HOA ĐÀO RƠI
        // ============================================
        let petalCount = 0;
        const petalSymbols = ['🌸', '🏵️', '💮'];
        function createPetal() {
            if (petalCount >= PERF.maxPetals) return;
            petalCount++;
            const petal = document.createElement('span'); petal.className = 'petal';
            petal.textContent = petalSymbols[Math.floor(Math.random() * petalSymbols.length)];
            const duration = 8 + Math.random() * 6;
            petal.style.cssText = `left:${Math.random() * 100}%;font-size:${14 + Math.random() * 12}px;animation-duration:${duration}s`;
            document.body.appendChild(petal);
            setTimeout(() => { petal.remove(); petalCount--; }, duration * 1000);
        }
        function startPetals() {
            for (let i = 0; i < (IS_MOBILE ? 2 : 5); i++) setTimeout(createPetal, i * 500);
            setInterval(createPetal, PERF.petalInterval);
        }

        // ============================================
        // 6. TYPING EFFECT
        // ============================================
        let typingStarted = false; let typingDone = false;
        function startTyping() {
            if (typingStarted) return; typingStarted = true;
            const textEl = document.querySelector('.message-text');
            const sigEl = document.querySelector('.message-signature');
            if (!textEl) return;

            const chars = MESSAGE_TEXT.split(''); let idx = 0; let html = '';
            textEl.innerHTML = '<span class="cursor"></span>';

            function typeNext() {
                if (idx >= chars.length) {
                    textEl.innerHTML = html.replace(/\n/g, '<br>');
                    if (sigEl) sigEl.classList.add('show');
                    typingDone = true; return;
                }
                const ch = chars[idx]; html += ch;
                textEl.innerHTML = html.replace(/\n/g, '<br>') + '<span class="cursor"></span>';
                idx++;
                const delay = ch === '.' ? 100 : ch === ',' ? 70 : ch === '!' ? 80 : ch === '\n' ? 200 : 25 + Math.random() * 25;
                setTimeout(typeNext, delay);
            }
            setTimeout(typeNext, 800);
        }

        // ============================================
        // 7. CONFETTI
        // ============================================
        function spawnConfetti(count) {
            const colors = ['#ff6b9d', '#ffd700', '#ff4466', '#c084fc', '#ff9ec5', '#7dd3fc'];
            for (let i = 0; i < count; i++) {
                const el = document.createElement('div'); el.className = 'confetti-piece';
                const size = 6 + Math.random() * 8; const x = Math.random() * window.innerWidth; const dur = 2 + Math.random() * 2;
                el.style.cssText = `left:${x}px;top:-10px;width:${size}px;height:${size * 0.6}px;background:${colors[Math.floor(Math.random() * colors.length)]};animation-duration:${dur}s;animation-delay:${Math.random() * 0.5}s;border-radius:${Math.random() > 0.5 ? '50%' : '2px'}`;
                document.body.appendChild(el);
                setTimeout(() => el.remove(), (dur + 0.5) * 1000);
            }
        }

        // ============================================
        // 8. GIFT BOX
        // ============================================
        let giftOpened = false;
        function openGift() {
            if (giftOpened) return; giftOpened = true;
            const box = document.querySelector('.gift-box'); const msg = document.querySelector('.gift-message');
            if (box) box.classList.add('opened');
            setTimeout(() => { if (msg) msg.classList.add('show'); spawnConfetti(IS_MOBILE ? 10 : 30); }, 800);
        }

        // ============================================
        // 9. MUSIC CONTROL
        // ============================================
        function tryPlayMusic() {
            audioElement = document.getElementById('bg-music');
            if (audioElement) {
                audioElement.volume = 0.5;
                const playPromise = audioElement.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => { musicPlaying = true; updateMusicBtn(true); }).catch(error => {
                        console.log("Autoplay prevented. Waiting for interaction.");
                        document.addEventListener('click', playMusicOnInteraction, { once: true });
                        document.addEventListener('touchstart', playMusicOnInteraction, { once: true });
                    });
                }
            }
        }
        function playMusicOnInteraction() {
            if (audioElement && audioElement.paused) {
                audioElement.play().then(() => { musicPlaying = true; updateMusicBtn(true); }).catch(e => console.error("Audio play failed:", e));
            }
        }
        function toggleMusic() {
            if (musicPlaying) {
                musicPlaying = false; updateMusicBtn(false); if (audioElement && !audioElement.paused) audioElement.pause();
            } else {
                musicPlaying = true; updateMusicBtn(true); if (audioElement) audioElement.play().catch(e => console.error("Audio play failed:", e));
            }
        }
        function updateMusicBtn(playing) {
            const btn = document.querySelector('.music-btn'); if (!btn) return;
            btn.textContent = playing ? '🎵' : '🔇'; btn.classList.toggle('playing', playing);
        }

        // ============================================
        // 10. VIDEO OVERLAY
        // ============================================
        function checkVideo() {
            // Không cần check date nữa vì đang test mode
        }
        function showVideo() {
            const overlay = document.getElementById('video-overlay');
            const video = document.getElementById('celebration-video');
            if (!overlay || !video) return;
            overlay.classList.add('active');
            video.play().catch(() => { });
            video.addEventListener('ended', () => { overlay.classList.remove('active'); });
        }

        // ============================================
        // 11. CURSOR TRAIL
        // ============================================
        let trailCount = 0;
        function startCursorTrail() {
            const hearts = ['💕', '💖', '💗', '✨', '💝']; let lastTime = 0;
            function createTrailHeart(x, y) {
                if (trailCount >= PERF.maxCursorTrail) return;
                const now = Date.now(); if (now - lastTime < 50) return; lastTime = now; trailCount++;
                const el = document.createElement('span'); el.className = 'cursor-heart';
                el.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                el.style.cssText = `left:${x}px;top:${y}px;font-size:${10 + Math.random() * 12}px`;
                document.body.appendChild(el);
                setTimeout(() => { el.remove(); trailCount--; }, 1000);
            }
            document.addEventListener('mousemove', e => createTrailHeart(e.clientX, e.clientY), { passive: true });
            document.addEventListener('touchmove', e => {
                const touch = e.touches[0]; if (touch) createTrailHeart(touch.clientX, touch.clientY);
            }, { passive: true });
        }

        // ============================================
        // 12. ĐÈN LỒNG
        // ============================================
        let lanternCount = 0;
        function createLantern() {
            if (lanternCount >= PERF.maxLanterns) return; lanternCount++;
            const el = document.createElement('div'); el.className = 'lantern';
            el.innerHTML = '<div class="lantern-body"><div class="lantern-glow"></div></div>';
            const duration = 12 + Math.random() * 8; const startX = 5 + Math.random() * 90;
            el.style.cssText = `left:${startX}%;animation-duration:${duration}s`;
            document.body.appendChild(el);
            setTimeout(() => { el.remove(); lanternCount--; }, duration * 1000);
        }
        function startLanterns() {
            createLantern(); setTimeout(createLantern, 2000); setInterval(createLantern, PERF.lanternInterval);
        }

        // ============================================
        // 13. PARTICLE TEXT
        // ============================================
        let ptCanvas, ptCtx, ptParticles = [], ptRunning = false;
        function startParticleText() {
            ptCanvas = document.getElementById('particle-text-canvas'); if (!ptCanvas) return;
            ptCtx = ptCanvas.getContext('2d'); ptCanvas.width = window.innerWidth; ptCanvas.height = window.innerHeight;
            const overlay = document.getElementById('particle-text-overlay'); if (overlay) overlay.classList.add('active');
            const temp = document.createElement('canvas'); const tCtx = temp.getContext('2d');
            temp.width = ptCanvas.width; temp.height = ptCanvas.height;
            let fs = Math.min(ptCanvas.width / 6, 100);
            tCtx.font = `bold ${fs}px 'Great Vibes', 'Quicksand', sans-serif`;
            while (tCtx.measureText(LOVER_NAME).width > ptCanvas.width * 0.7) {
                fs -= 2; tCtx.font = `bold ${fs}px 'Great Vibes', 'Quicksand', sans-serif`; if (fs < 20) break;
            }
            tCtx.fillStyle = '#fff'; tCtx.textAlign = 'center'; tCtx.textBaseline = 'middle';
            tCtx.fillText(LOVER_NAME, temp.width / 2, temp.height / 2 + 15);
            const imageData = tCtx.getImageData(0, 0, temp.width, temp.height);
            const positions = []; const gap = IS_MOBILE ? 4 : 3;
            for (let y = 0; y < temp.height; y += gap) {
                for (let x = 0; x < temp.width; x += gap) {
                    if (imageData.data[(y * temp.width + x) * 4 + 3] > 128) { positions.push({ x, y }); }
                }
            }
            const selected = []; const maxParticles = IS_MOBILE ? 800 : 2500;
            const max = Math.min(positions.length, maxParticles); const step = Math.max(1, Math.floor(positions.length / max));
            for (let i = 0; i < positions.length && selected.length < max; i += step) { selected.push(positions[i]); }
            const colors = ['#ffd700', '#ff6b9d', '#ff9ec5', '#ffe44d', '#ffffff', '#ff4466'];
            ptParticles = selected.map(pos => ({
                x: Math.random() * ptCanvas.width, y: Math.random() * ptCanvas.height,
                tx: pos.x, ty: pos.y, size: IS_MOBILE ? (2.5 + Math.random() * 1.5) : (2 + Math.random() * 1.5),
                color: colors[Math.floor(Math.random() * colors.length)], speed: 0.05 + Math.random() * 0.05,
            }));
            ptRunning = true; let startTime = Date.now();
            function animate() {
                if (!ptRunning) return;
                ptCtx.clearRect(0, 0, ptCanvas.width, ptCanvas.height);
                const elapsed = Date.now() - startTime;
                for (const p of ptParticles) {
                    if (elapsed < 2000) { p.x += (p.tx - p.x) * 0.08; p.y += (p.ty - p.y) * 0.08; }
                    else if (elapsed < 5000) {
                        const flutterX = Math.sin(elapsed * 0.005 + p.y * 0.01) * 0.5;
                        const flutterY = Math.cos(elapsed * 0.005 + p.x * 0.01) * 0.5;
                        p.x = p.tx + flutterX; p.y = p.ty + flutterY;
                    } else {
                        p.x += (Math.cos(elapsed * 0.002 + p.y) * 5); p.y -= Math.random() * 3; p.size *= 0.95;
                    }
                    let alpha = 1;
                    if (elapsed < 500) alpha = elapsed / 500;
                    else if (elapsed > 4500) alpha = Math.max(0, 1 - (elapsed - 4500) / 1000);
                    ptCtx.globalAlpha = alpha; ptCtx.fillStyle = p.color; ptCtx.beginPath();
                    ptCtx.arc(p.x, p.y, p.size / 2, 0, Math.PI * 2); ptCtx.fill();
                }
                if (elapsed < 6000) { requestAnimationFrame(animate); }
                else { ptRunning = false; ptCtx.clearRect(0, 0, ptCanvas.width, ptCanvas.height); if (overlay) overlay.classList.remove('active'); }
            }
            animate();
        }

        // ============================================
        // 15. SHAKE DETECTION
        // ============================================
        function initShakeDetection() {
            if (!IS_MOBILE) return;
            let lastShake = 0;
            function handleShake(e) {
                const acc = e.accelerationIncludingGravity; if (!acc) return;
                const force = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
                if (force > 35 && Date.now() - lastShake > 1500) {
                    lastShake = Date.now();
                    for (let i = 0; i < 4; i++) setTimeout(launchFirework, i * 200);
                    spawnConfetti(IS_MOBILE ? 15 : 30);
                }
            }
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                document.addEventListener('click', function iosPermission() {
                    DeviceMotionEvent.requestPermission().then(p => {
                        if (p === 'granted') window.addEventListener('devicemotion', handleShake, { passive: true });
                    }).catch(() => { });
                    document.removeEventListener('click', iosPermission);
                }, { once: true });
            } else { window.addEventListener('devicemotion', handleShake, { passive: true }); }
        }

        // ============================================
        // 16. PAGE NAVIGATION
        // ============================================
        function initPageNav() {
            const dotsContainer = document.getElementById('page-dots'); if (!dotsContainer) return;
            dotsContainer.innerHTML = '';
            for (let i = 0; i < totalPages; i++) {
                const dot = document.createElement('div'); dot.className = 'page-dot' + (i === 0 ? ' active' : '');
                dot.onclick = () => goToPage(i); dotsContainer.appendChild(dot);
            }
            document.addEventListener('keydown', e => {
                if (isOverlayActive()) return;
                if (e.key === 'ArrowRight' || e.key === 'ArrowDown') changePage(1);
                if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') changePage(-1);
            });
            let touchStartX = 0, touchStartY = 0;
            const main = document.getElementById('main-content'); if (!main) return;
            main.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; }, { passive: true });
            main.addEventListener('touchend', e => {
                const diffX = e.changedTouches[0].clientX - touchStartX; const diffY = e.changedTouches[0].clientY - touchStartY;
                if (Math.abs(diffX) > 50 && Math.abs(diffX) > Math.abs(diffY)) { changePage(diffX > 0 ? -1 : 1); }
            }, { passive: true });
        }

        function scheduleUnlockPageNav() {
            const video = document.getElementById('celebration-video');
            if (video && video.duration) {
                video.addEventListener('ended', () => { setTimeout(unlockPageNav, 1000); });
                setTimeout(unlockPageNav, 15000);
            } else { setTimeout(unlockPageNav, 5000); }
        }

        function unlockPageNav() {
            if (!pageNavLocked) return; pageNavLocked = false;
            const nav = document.getElementById('page-nav'); if (nav) { nav.style.opacity = '1'; nav.style.pointerEvents = 'auto'; }
            const hint = document.querySelector('.page-hint'); if (hint) hint.style.opacity = '1';
            setTimeout(startAutoPlay, 2000);
        }

        function changePage(direction) {
            if (pageNavLocked) return;
            const newPage = currentPage + direction;
            if (newPage < 0 || newPage >= totalPages) return;
            goToPage(newPage);
        }

        function goToPage(pageIndex) {
            if (pageNavLocked) return;
            if (pageIndex === currentPage || pageIndex < 0 || pageIndex >= totalPages) return;
            const goingForward = pageIndex > currentPage;
            const allPages = document.querySelectorAll('.page');
            allPages.forEach(p => { p.classList.remove('active', 'slide-out-left', 'slide-out-right', 'enter-from-left', 'enter-from-right'); });
            const oldPageEl = document.getElementById('page-' + currentPage);
            const newPageEl = document.getElementById('page-' + pageIndex);
            if (oldPageEl) { oldPageEl.classList.add(goingForward ? 'slide-out-left' : 'slide-out-right'); }
            if (newPageEl) {
                newPageEl.classList.add(goingForward ? 'enter-from-right' : 'enter-from-left');
                newPageEl.offsetHeight;
                newPageEl.classList.remove('enter-from-right', 'enter-from-left'); newPageEl.classList.add('active');
            }
            currentPage = pageIndex; updateDots();
            if (pageIndex === 1) setTimeout(startTyping, 500);
            setTimeout(() => { if (oldPageEl) { oldPageEl.classList.remove('slide-out-left', 'slide-out-right'); } }, 800);
        }

        function updateDots() {
            const dots = document.querySelectorAll('.page-dot');
            dots.forEach((d, i) => d.classList.toggle('active', i === currentPage));
        }

        // ============================================
        // 17. AUTO-PLAY
        // ============================================
        function startAutoPlay() {
            setTimeout(() => { goToPage(1); waitForTypingThenNext(); }, 8000);
        }
        function waitForTypingThenNext() {
            const check = setInterval(() => {
                if (typingDone) {
                    clearInterval(check);
                    setTimeout(() => {
                        goToPage(2);
                        setTimeout(() => { goToPage(3); setTimeout(openGift, 2000); }, 6000);
                    }, 3000);
                }
            }, 500);
        }

        // ============================================
        // 18. STARFIELD & 19. PARTICLES
        // ============================================
        function initStarfield() {
            const container = document.getElementById('starfield'); if (!container) return;
            for (let i = 0; i < PERF.starCount; i++) {
                const star = document.createElement('div'); star.className = 'star';
                const size = 1 + Math.random() * 2;
                star.style.cssText = `left:${Math.random() * 100}%;top:${Math.random() * 100}%;width:${size}px;height:${size}px;animation-duration:${2 + Math.random() * 4}s;animation-delay:${Math.random() * 4}s`;
                if (Math.random() > 0.7) star.style.background = '#ffd700';
                container.appendChild(star);
            }
        }
        let bgPCount = 0;
        function createBackgroundParticle() {
            if (bgPCount >= PERF.maxBgParticles) return; bgPCount++;
            const el = document.createElement('span'); el.className = 'bg-particle';
            const symbols = ['💕', '✨', '⭐', '💖']; el.textContent = symbols[Math.floor(Math.random() * symbols.length)];
            const duration = 15 + Math.random() * 15;
            el.style.cssText = `left:${Math.random() * 100}%;font-size:${10 + Math.random() * 10}px;animation-duration:${duration}s;animation-delay:${Math.random() * 3}s`;
            document.body.appendChild(el);
            setTimeout(() => { el.remove(); bgPCount--; }, (duration + 3) * 1000);
        }
        function startBackgroundParticles() {
            for (let i = 0; i < (IS_MOBILE ? 2 : 5); i++) setTimeout(createBackgroundParticle, i * 1000);
            setInterval(createBackgroundParticle, PERF.bgParticleInterval);
        }

        // ============================================
        // 20. LIGHTBOX GALLERY
        // ============================================
        const galleryImages = [
            'anh/z7538148079369_3b58fabb2458d542f45aefeebda582c7.jpg',
            'anh/z7538148093159_dacd11dcaad58e8e406992b324ca4f2f.jpg',
            'anh/z7538148094666_23071c33da61f65b1d9e2db02f653a92.jpg',
            'anh/z7538148096271_3e4d0bae9afa7e4f63c6d4238af9b7f6.jpg',
            'anh/z7538148098402_2769a9f1161dc0a42d9e278b22d51cbc.jpg',
            'anh/z7538148099395_4ae7117b33d731b95866a1bf7b777b2c.jpg',
            'anh/z7538148099754_e8a7d114bfc8bbdf388bf294299ca603.jpg',
            'anh/z7538148103158_ba5320d36f22d72e295cfb8bd9cab7b6.jpg',
            'anh/z7538148108267_0cf240873128321c89c46a28f268666e.jpg',
            'anh/z7538148110785_51ea48c139aa8111b43dcb59c1f08972.jpg',
            'anh/z7538148121807_f9aaa722193a0105f902a313114fc49a.jpg',
            'anh/z7538148123540_7080aabd5aede31a0b3faf656633d788.jpg',
            'anh/z7538148126717_a306674fd19fe2921ae5ab4fe4e695c3.jpg',
        ];
        let currentLightboxIndex = 0;
        function openLightbox(index) {
            currentLightboxIndex = index;
            const lightbox = document.getElementById('lightbox'); const img = document.getElementById('lightbox-img'); const counter = document.getElementById('lightbox-counter');
            if (!lightbox || !img) return;
            img.src = galleryImages[index]; counter.textContent = `${index + 1} / ${galleryImages.length}`; lightbox.classList.add('active');
        }
        function closeLightbox(event) {
            if (event && event.target !== event.currentTarget && !event.target.classList.contains('lightbox-close')) return;
            const lightbox = document.getElementById('lightbox'); if (lightbox) lightbox.classList.remove('active');
        }
        function changeLightboxImage(direction, event) {
            if (event) event.stopPropagation();
            currentLightboxIndex += direction;
            if (currentLightboxIndex < 0) currentLightboxIndex = galleryImages.length - 1;
            if (currentLightboxIndex >= galleryImages.length) currentLightboxIndex = 0;
            const img = document.getElementById('lightbox-img'); const counter = document.getElementById('lightbox-counter');
            if (img) img.src = galleryImages[currentLightboxIndex]; if (counter) counter.textContent = `${currentLightboxIndex + 1} / ${galleryImages.length}`;
        }
        document.addEventListener('keydown', e => {
            const lightbox = document.getElementById('lightbox');
            if (!lightbox || !lightbox.classList.contains('active')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') changeLightboxImage(-1);
            if (e.key === 'ArrowRight') changeLightboxImage(1);
        });
        (function initLightboxSwipe() {
            let touchStartX = 0;
            const lightbox = document.getElementById('lightbox'); if (!lightbox) return;
            lightbox.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; }, { passive: true });
            lightbox.addEventListener('touchend', e => {
                const diff = e.changedTouches[0].clientX - touchStartX;
                if (Math.abs(diff) > 50) changeLightboxImage(diff > 0 ? -1 : 1);
            }, { passive: true });
        })();

        // ============================================
        // 21. 3D TILT CHO POLAROID
        // ============================================
        function initPolaroidTilt() {
            if (IS_MOBILE) return;
            const gallery = document.getElementById('polaroid-gallery'); if (!gallery) return;
            gallery.addEventListener('mousemove', (e) => {
                const cards = gallery.querySelectorAll('.polaroid');
                cards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2;
                    const mouseX = e.clientX - centerX; const mouseY = e.clientY - centerY;
                    const dist = Math.sqrt(mouseX * mouseX + mouseY * mouseY);
                    if (dist < 250) {
                        const rotateY = (mouseX / rect.width) * 15; const rotateX = -(mouseY / rect.height) * 15;
                        const intensity = 1 - Math.min(dist / 250, 1);
                        card.style.transform = `perspective(600px) rotateX(${rotateX * intensity}deg) rotateY(${rotateY * intensity}deg) scale(${1 + intensity * 0.05})`;
                        card.style.boxShadow = `${-rotateY * 0.5}px ${rotateX * 0.5}px 30px rgba(255, 107, 157, ${0.15 + intensity * 0.2}), 0 5px 15px rgba(0,0,0,0.3)`;
                    } else {
                        card.style.transform = `rotate(${getComputedStyle(card).getPropertyValue('--rotate') || '0deg'})`; card.style.boxShadow = '';
                    }
                });
            });
            gallery.addEventListener('mouseleave', () => {
                gallery.querySelectorAll('.polaroid').forEach(card => {
                    card.style.transform = `rotate(${getComputedStyle(card).getPropertyValue('--rotate') || '0deg'})`; card.style.boxShadow = '';
                });
            });
        }

        // ============================================
        // KHỞI TẠO
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            initPasscode();
            initWelcome();
            initStarfield();
            checkVideo();
            initShakeDetection();
            initPolaroidTilt();
        });
    </script>
</body>

</html>